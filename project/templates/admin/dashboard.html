{% extends "admin/base.html" %}

{% block content %}
<div class="dashboard-container">
    <h1>Orders</h1>
    
    <div class="orders-grid">
        {% for order in orders %}
        <div class="order-card">
            <div class="order-header">
                <h3>Order #{{ order.id }}</h3>
                <select onchange="updateOrderStatus('{{ order.id }}', this.value)" class="status-select status-{{ order.status.lower() }}">
                    <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                    <option value="Confirmed" {% if order.status == 'Confirmed' %}selected{% endif %}>Confirmed</option>
                    <option value="Processing" {% if order.status == 'Processing' %}selected{% endif %}>Processing</option>
                    <option value="Ready" {% if order.status == 'Ready' %}selected{% endif %}>Ready</option>
                    <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                    <option value="Cancelled" {% if order.status == 'Cancelled' %}selected{% endif %}>Cancelled</option>
                </select>
            </div>
            
            <div class="order-details">
                <p><strong>Customer:</strong> {{ order.name }}</p>
                <p><strong>Email:</strong> {{ order.email }}</p>
                <p><strong>Phone:</strong> {{ order.phone }}</p>
                <p><strong>Delivery Date:</strong> {{ order.delivery_date.strftime('%Y-%m-%d') }}</p>
                <p><strong>Delivery Type:</strong> {{ order.delivery_type }}</p>
                <p><strong>Address:</strong> {{ order.address }}</p>
                
                <div class="order-items">
                    <h4>Items:</h4>
                    <ul>
                    {% for item in order.items %}
                        <li>{{ item.name }} - â‚¹{{ item.price }} x {{ item.quantity }}</li>
                    {% endfor %}
                    </ul>
                </div>
                
                {% if order.custom_requirements %}
                <div class="custom-requirements">
                    <h4>Custom Requirements:</h4>
                    <p>{{ order.custom_requirements }}</p>
                </div>
                {% endif %}
                
                {% if order.reference_photo %}
                <div class="reference-photo">
                    <h4>Reference Photo:</h4>
                    <img src="{{ url_for('static', filename=order.reference_photo) }}" alt="Reference Photo">
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
function updateOrderStatus(orderId, newStatus) {
    fetch(`/admin/order/${orderId}/status`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ status: newStatus })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update the select element's class
            const select = document.querySelector(`select[onchange*="${orderId}"]`);
            select.className = `status-select status-${newStatus.toLowerCase()}`;
            
            // Show success message
            alert('Order status updated successfully');
        } else {
            alert(data.message || 'Error updating order status');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error updating order status');
    });
}
</script>

{% block extra_css %}
<style>
.dashboard-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.orders-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
}

.order-card {
    background: white;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.order-header {
    background: var(--primary-color);
    color: white;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.order-header h3 {
    margin: 0;
}

.status-select {
    padding: 0.5rem;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
}

.status-pending { background: #ffc107; }
.status-confirmed { background: #17a2b8; }
.status-processing { background: #007bff; }
.status-ready { background: #28a745; }
.status-delivered { background: #6c757d; }
.status-cancelled { background: #dc3545; }

.order-details {
    padding: 1.5rem;
}

.order-details p {
    margin: 0.5rem 0;
}

.order-items {
    margin-top: 1.5rem;
}

.order-items ul {
    list-style: none;
    padding: 0;
    margin: 0.5rem 0;
}

.order-items li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #eee;
}

.order-items li:last-child {
    border-bottom: none;
}

.custom-requirements,
.reference-photo {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
    border-top: 1px solid #eee;
}

.reference-photo img {
    max-width: 100%;
    height: auto;
    border-radius: 5px;
    margin-top: 0.5rem;
}

@media (max-width: 768px) {
    .dashboard-container {
        padding: 1rem;
    }
    
    .orders-grid {
        grid-template-columns: 1fr;
    }
    
    .order-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
}
</style>
{% endblock %}
{% endblock %}
